I"yJ<h3 id="sobre-a-documentação">Sobre a documentação</h3>

<p>Seja bem vindo à documentação da API do Atlas da Notícia.</p>

<p>O <strong>Atlas da Notícia</strong> é uma iniciativa para mapear veículos produtores de notícias – especialmente de jornalismo local – no território brasileiro.</p>

<p>Esta é uma API que implementa o protocolo <code class="language-plaintext highlighter-rouge">REST</code> para a comunicação com os sistemas com uma autenticação do tipo JWT para a segurança das aplicações.</p>

<p>Esta página contém aspectos mais técnicos sobre a API e seu uso. Caso ainda esteja no começo da sua experiência com a APIs e de compreensão de <em>endpoints</em>, por favor recorra primeiro a <a href="../utilizarAPI">este documento</a>, que detalha o passo a passo inicial para usar esse recurso.</p>

<h3 id="autenticação">Autenticação</h3>

<p>A API conta com o padrão JWT para autenticar seus usuários.</p>

<p>Para que você possa autenticar, é necessário ter um usuário cadastrado no nosso sistema. Caso ainda não tenha, <a href="https://api.atlas.jor.br/register">faça cadastro aqui</a>.</p>

<p>Para acessar os endpoints da API você deve usar o token como Bearer, incluindo-o no Header de sua requisição.</p>

<p>Com o usuário cadastrado, você pode realizar uma solicitação <code class="language-plaintext highlighter-rouge">POST</code> na nossa API com as seguintes informações:</p>

<h4 id="endpoint">Endpoint</h4>

<p><code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/api/v1/auth/login</code></p>

<h4 id="json-request">JSON Request</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    {
    "email": "seu@email",
    "password": "sua senha"
    }
</code></pre></div></div>

<h4 id="resposta-com-o-token-será-enviada-para-você">Resposta com o token será enviada para você</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    {
        "access_token": "seu_token",
        "token_type": "bearer",
        "expires_in": 3600
    }
</code></pre></div></div>

<h4 id="renovando-o-token">Renovando o token</h4>

<p>Para renovar o token da sua aplicação, basta realizar o refresh do mesmo pela API. Neste Endpoint, você vai realizar um POST passando o token como Bearer token no Header da Requisição de acordo com o exemplo abaixo:</p>

<h4 id="endpoint-1">Endpoint</h4>

<p><code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/api/v1/auth/refresh</code></p>

<p>Resposta com o novo token será enviada para você, no mesmo formanto do primeiro token.</p>

<h4 id="documentação-do-json">Documentação do JSON</h4>

<table>
  <thead>
    <tr>
      <th>COLUNA</th>
      <th>VALOR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>access_token</td>
      <td>Token de acesso para a API</td>
    </tr>
    <tr>
      <td>token_type</td>
      <td>Tipo de token</td>
    </tr>
    <tr>
      <td>expires_in</td>
      <td>Tempo em segundos de validade do token</td>
    </tr>
  </tbody>
</table>

<hr />

<h3 id="endpoints-de-dados">Endpoints de dados</h3>

<p>Endpoints são as URL’s que a API provê para o retorno dos dados. A API do Atlas da Notícia possui diversos endpoints, cada um retornando um conjunto diferente de informações.</p>

<p>A URL base da aplicação é: <code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/</code></p>

<p>A aplicação tem um controle de versão, caso a API seja atualizada de maneira a impactar nas aplicações-clientes. A versão é sempre colocada após a URL base: <code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/api/versão</code></p>

<p>A url então deve ficar no seguinte formato: <code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/api/v1</code></p>

<p>Após a versão, é necessário incluir o endpoint desejado para realizar a busca.</p>

<h4 id="filtros">Filtros</h4>

<p>A API é preparada para receber filtros de acordo com os campos desejados na consulta. Para facilitar a descoberta dos campos, a aplicação dispõe para cada endpoint, um método que retorna os campos disponíveis.</p>

<p>Os tipos de filtros disponíveis são:</p>

<table>
  <thead>
    <tr>
      <th>TIPO</th>
      <th>REPRESENTAÇÃO</th>
      <th>DESCRIÇÃO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Equalidade</td>
      <td>Parâmetro padrão na URL</td>
      <td>É um parâmetro comum na URL, baseado nos campos disnívies no endpoint</td>
    </tr>
    <tr>
      <td>Parcialidade</td>
      <td>lk</td>
      <td>É o LIKE do SQL, onde temos uma busca parcial de um conteúdo do tipo String</td>
    </tr>
    <tr>
      <td>Agrupamento</td>
      <td>Parâmetro do tipo array na URL</td>
      <td>É o IN do SQL. Para que o sistema filtre nesse formato, é necessário enviar como array.</td>
    </tr>
    <tr>
      <td>Maior Igual</td>
      <td>gt</td>
      <td>Define o início de um range de dados.</td>
    </tr>
    <tr>
      <td>Menor Igual</td>
      <td>lt</td>
      <td>Define o fim de um range de dados.</td>
    </tr>
  </tbody>
</table>

<h4 id="exemplos-de-filtros">Exemplos de Filtros</h4>

<ul>
  <li>
    <p>Equalidade: <code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/api/v1/endpoint?parametro=valor</code></p>
  </li>
  <li>
    <p>Parcialiade: <code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/api/v1/endpoint?parametro[lk]=valor</code></p>
  </li>
  <li>
    <p>Agrupamento: <code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/api/v1/endpoint?parametro[]=valor1¶metro[]=valor2...</code></p>
  </li>
  <li>
    <p>Maior Igual: <code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/api/v1/endpoint?parametro[gt]=valor</code></p>
  </li>
  <li>
    <p>Menor Igual: <code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/api/v1/endpoint?parametro[lt]=valor</code></p>
  </li>
  <li>
    <p>Between: <code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/api/v1/endpoint?parametro[gt]=valor¶metro[lt]=valor</code></p>
  </li>
</ul>

<h4 id="campos">Campos</h4>

<p>A API conta com a possibilidade de filtrar quais campos serão retornados. Para isso, é necessário enviar um parâmetro na url chamado <code class="language-plaintext highlighter-rouge">field</code>.</p>

<p>Exemplo: <code class="language-plaintext highlighter-rouge">https://api.atlas.jor.br/api/v1/endpoint?field[]=campo_1&amp;field[]=campo_2&amp;...</code></p>

<hr />

<h3 id="atlas-analytic">Atlas Analytic</h3>

<p>Endpoint que retorna uma lista de veículos de acordo com os filtros.</p>

<h4 id="retorna-os-dados">Retorna os dados:</h4>

<p>GET: <code class="language-plaintext highlighter-rouge">/data/analytic</code></p>

<h4 id="retorna-as-definições">Retorna as definições:</h4>

<p>GET: <code class="language-plaintext highlighter-rouge">/data/analytic/definitions</code></p>

<p>Retorno (Definições):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    [
      "id",
      "nome_veiculo",
      "fonte",
      "segmento",
      "cidade",
      "cod_mun_ibge",
      "estado",
      "regiao",
      "address",
      "annotations",
      "email",
      "num_funcionarios",
      "periodicity",
      "another_periodicity",
      "eh_jornal",
      "eh_site_pago",
      "data_fechamento"
    ]
</code></pre></div></div>

<h4 id="retorno-do-endpoint-amostra">Retorno do endpoint (amostra)</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    [
      {
        "id": 5114,
        "nome_veiculo": "A GAZETA DO ACRE",
        "fonte": "Atlas da Notícia",
        "segmento": "Impresso",
        "cidade": "Rio Branco",
        "cod_mun_ibge": "1200401",
        "estado": "AC",
        "regiao": "Norte",
        "address": "Av Antonio da Rocha Viana, 1503. Vila Ivonte",
        "annotations": null,
        "email": "agazeta.jornal@gmail.com",
        "num_funcionarios": "6 a 9 colaboradores",
        "periodicity": "daily",
        "another_periodicity": null,
        "eh_jornal": 1,
        "eh_site_pago": 0,
        "data_fechamento": null,
        "business_models": [
          {
            "id": 1,
            "name": "Assinatura\/paywall",
            "created_at": "2019-10-29 00:21:45",
            "updated_at": "2019-10-29 00:21:45",
            "deleted_at": null,
            "pivot": {
              "media_id": 5114,
              "business_model_id": 1
            }
          }
        ],
        "features": [
          {
            "id": 4,
            "name": "Noticiário em tempo real",
            "created_at": "2019-10-29 00:21:45",
            "updated_at": "2019-10-29 00:21:45",
            "deleted_at": null,
            "pivot": {
              "media_id": 5114,
              "feature_id": 4
            }
          },
          {
            "id": 5,
            "name": "Opinião\/colunistas",
            "created_at": "2019-10-29 00:21:45",
            "updated_at": "2019-10-29 00:21:45",
            "deleted_at": null,
            "pivot": {
              "media_id": 5114,
              "feature_id": 5
            }
          },
          {
            "id": 7,
            "name": "Possui alguma edição impressa",
            "created_at": "2019-10-29 00:21:45",
            "updated_at": "2019-10-29 00:21:45",
            "deleted_at": null,
            "pivot": {
              "media_id": 5114,
              "feature_id": 7
            }
          },
          {
            "id": 8,
            "name": "Redes sociais",
            "created_at": "2019-10-29 00:21:45",
            "updated_at": "2019-10-29 00:21:45",
            "deleted_at": null,
            "pivot": {
              "media_id": 5114,
              "feature_id": 8
            }
          }
        ],
        "collaborators": [
          {
            "id": 3,
            "name": "Estudante",
            "created_at": "2019-10-29 00:21:45",
            "updated_at": "2019-10-29 00:21:45",
            "deleted_at": null,
            "pivot": {
              "media_id": 5114,
              "collaborator_id": 3
            }
          }
        ],
        "media_channels": [
          {
            "id": 249,
            "channel_id": 1,
            "link": "https:\/\/agazetadoacre.com\/",
            "media_id": 5114,
            "created_at": "2019-10-29 00:24:32",
            "updated_at": "2019-10-29 00:24:32",
            "deleted_at": null,
            "channel": {
              "id": 1,
              "name": "Site",
              "text_hint": "Cole aqui a URL do veículo, se houver. É um item importante para nós, e nos ajudará na validação de sua sugestão - mas entendemos que alguns veículos nem site têm, por isso não é obrigatório. Agradecemos o esforço!",
              "created_at": "2019-10-29 00:21:45",
              "updated_at": "2019-10-29 00:21:45",
              "deleted_at": null
            }
          },
          {
            "id": 1100,
            "channel_id": 2,
            "link": "https:\/\/twitter.com\/agazetadoacre",
            "media_id": 5114,
            "created_at": "2019-10-29 00:24:32",
            "updated_at": "2019-10-29 00:24:32",
            "deleted_at": null,
            "channel": {
              "id": 2,
              "name": "Twitter",
              "text_hint": "Se houver, favor colocar link direto para a conta - se souber apenas o nome (ex. @observatório), acrescente antes https:\/\/twitter.com\/@nome  da pagina",
              "created_at": "2019-10-29 00:21:45",
              "updated_at": "2019-10-29 00:21:45",
              "deleted_at": null
            }
          },
          {
            "id": 1653,
            "channel_id": 3,
            "link": "https:\/\/www.facebook.com\/A-Gazeta-do-Acre-208579685881525\/",
            "media_id": 5114,
            "created_at": "2019-10-29 00:24:32",
            "updated_at": "2019-10-29 00:24:32",
            "deleted_at": null,
            "channel": {
              "id": 3,
              "name": "Facebook",
              "text_hint": "Se houver, favor colocar link direto para a conta - se souber apenas o nome (ex. @observatório), acrescente antes https:\/\/facebook.com\/@nome  da pagin",
              "created_at": "2019-10-29 00:21:45",
              "updated_at": "2019-10-29 00:21:45",
              "deleted_at": null
            }
          }
        ]
      }
    ]
</code></pre></div></div>

<h4 id="abaixo-o-que-cada-coluna-representa">Abaixo o que cada coluna representa</h4>

<table>
  <thead>
    <tr>
      <th>COLUNA</th>
      <th>VALOR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>id</td>
      <td>Identificação do veículo</td>
    </tr>
    <tr>
      <td>nome_veiculo</td>
      <td>Nome do veículo</td>
    </tr>
    <tr>
      <td>fonte</td>
      <td>Em qual plataforma esses dados foram inputados</td>
    </tr>
    <tr>
      <td>segmento</td>
      <td>Segmento principal</td>
    </tr>
    <tr>
      <td>cidade</td>
      <td>Cidade onde está o veículo</td>
    </tr>
    <tr>
      <td>cod_mun_ibge</td>
      <td>Código do município no IBGE</td>
    </tr>
    <tr>
      <td>estado</td>
      <td>Estado do veículo</td>
    </tr>
    <tr>
      <td>regiao</td>
      <td>Região do veículo</td>
    </tr>
    <tr>
      <td>address</td>
      <td>Endereço do veículo</td>
    </tr>
    <tr>
      <td>annotations</td>
      <td>Observações sobre o veículo</td>
    </tr>
    <tr>
      <td>email</td>
      <td>Email do veículo</td>
    </tr>
    <tr>
      <td>num_funcionarios</td>
      <td>Número de funcionários do veículo</td>
    </tr>
    <tr>
      <td>periodicity</td>
      <td>Periodicidade do veículo</td>
    </tr>
    <tr>
      <td>another_periodicity</td>
      <td>Se a periodicidade for diferente das disponíveis, esse campo vai conter o texto explicando.</td>
    </tr>
    <tr>
      <td>eh_jornal</td>
      <td>Diz se o veículo é um jornal. 1 - Sim, 0 - Não</td>
    </tr>
    <tr>
      <td>eh_site_pago</td>
      <td>Diz se o veículo é financiado por alguém. 1 - Sim, 0 - Não</td>
    </tr>
    <tr>
      <td>data_fechamento</td>
      <td>Se houver data de fechamento, aqui ela estará descrita.</td>
    </tr>
    <tr>
      <td>business_models</td>
      <td>Modelos de negócios do veículo. Poder ter de 0 a n. (Array)</td>
    </tr>
    <tr>
      <td>features</td>
      <td>Características do veículo. Poder ter de 0 a n. (Array)</td>
    </tr>
    <tr>
      <td>collaborators</td>
      <td>Tipos de colaboradores que contribuíram par aos dados do veículo. Poder ter de 0 a n. (Array)</td>
    </tr>
    <tr>
      <td>media_channels</td>
      <td>Canais de mídia do veículo. Poder ter de 0 a n. (Array)</td>
    </tr>
    <tr>
      <td>media_channels.n.channel</td>
      <td>Definição do canal de mídia do veículo</td>
    </tr>
  </tbody>
</table>

<hr />

<h3 id="cidades-sem-veículos-agrupamento-por-região">Cidades sem veículos (agrupamento por região)</h3>

<p>Endpoint que retorna um agregado com a quantidade de cidades sem veículos por região.</p>

<p>Esse é o principal endpoint, que devolve todas as colunas brutas do nosso banco de dados.</p>

<h3 id="retorna-os-dados-1">Retorna os dados:</h3>

<p>GET: <code class="language-plaintext highlighter-rouge">/data/qtd-cities-without-media-region</code></p>

<h3 id="retorna-as-definições-1">Retorna as definições:</h3>

<p>GET: <code class="language-plaintext highlighter-rouge">/data/qtd-cities-without-media-region/definitions</code></p>

<h3 id="retorno-definições">Retorno (Definições):</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    [
      "regiao",
      "qtd_cidades",
      "qtd_desertos"
    ]
</code></pre></div></div>

<h3 id="retorno-do-endpoint">Retorno do endpoint</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    [
      {
        "regiao": "Centro-Oeste",
        "qtd_cidades": 467,
        "qtd_desertos": 224
      },
      {
        "regiao": "Nordeste",
        "qtd_cidades": 1794,
        "qtd_desertos": 1146
      },
      {
        "regiao": "Norte",
        "qtd_cidades": 450,
        "qtd_desertos": 315
      },
      {
        "regiao": "Sudeste",
        "qtd_cidades": 1668,
        "qtd_desertos": 633
      },
      {
        "regiao": "Sul",
        "qtd_cidades": 1191,
        "qtd_desertos": 544
      }
    ]
</code></pre></div></div>

<h4 id="abaixo-o-que-cada-coluna-representa-1">Abaixo o que cada coluna representa</h4>

<table>
  <thead>
    <tr>
      <th>COLUNA</th>
      <th>VALOR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>regiao</td>
      <td>Nome da Região.</td>
    </tr>
    <tr>
      <td>qtd_cidades</td>
      <td>Quantidade de cidades na região.</td>
    </tr>
    <tr>
      <td>qtd_desertos</td>
      <td>Quantidade de cidades que não tem veículos.</td>
    </tr>
  </tbody>
</table>

<h3 id="cidades-sem-veículos-por-estado">Cidades sem veículos por estado</h3>

<p>Endpoint que retorna um agregado com a quantidade de cidades sem veículos por estado.</p>

<h3 id="retorna-os-dados-2">Retorna os dados</h3>

<p>GET: <code class="language-plaintext highlighter-rouge">/data/qtd-cities-without-media-state</code></p>

<h3 id="retorna-as-definições-2">Retorna as definições</h3>

<p>GET: <code class="language-plaintext highlighter-rouge">/data/qtd-cities-without-media-state/definitions</code></p>

<h3 id="retorno-definições-1">Retorno (Definições)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    [
      "estado",
      "qtd_cidades",
      "qtd_desertos"
    ]
</code></pre></div></div>

<h3 id="retorno-do-endpoint-1">Retorno do endpoint</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    [
      {
        "estado": "AC",
        "qtd_cidades": 22,
        "qtd_desertos": 16
      },
      {
        "estado": "AL",
        "qtd_cidades": 102,
        "qtd_desertos": 58
      },
      {
        "estado": "AM",
        "qtd_cidades": 62,
        "qtd_desertos": 42
      }
    ]
</code></pre></div></div>

<h4 id="abaixo-o-que-cada-coluna-representa-2">Abaixo o que cada coluna representa</h4>

<table>
  <thead>
    <tr>
      <th>COLUNA</th>
      <th>VALOR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>estado</td>
      <td>Nome do estado.</td>
    </tr>
    <tr>
      <td>qtd_cidades</td>
      <td>Quantidade de cidades no estado.</td>
    </tr>
    <tr>
      <td>qtd_desertos</td>
      <td>Quantidade de cidades que não tem veículos.</td>
    </tr>
  </tbody>
</table>
:ET
I"÷@<h2 id="introdu√ß√£o-ao-newsatlasbr">Introdu√ß√£o ao newsatlasbr</h2>

<p><code class="language-plaintext highlighter-rouge">newsatlasbr</code> √© um pacote criado para a quarta vers√£o (v.4.0, de 2020) do <strong>Atlas da Not√≠cia</strong>, com a finalidade de facilitar o acesso aos bancos de dados do <a href="https://www.atlas.jor.br/">Atlas da Not√≠cia</a> por parte de pesquisadores e programadores.</p>

<p>O pacote extrai os dados diretamente da <a href="https://www.atlas.jor.br/plataforma/api/">API do projeto</a>, desenvolvida pelo <a href="https://www.voltdata.info/">Volt Data Lab</a>.</p>

<p>O desenvolvimento do pacote √© do cientista pol√≠tico e analista de dados do Volt Data Lab, <a href="https://twitter.com/lgelape">Lucas Gelape</a>, com contribui√ß√µes de <a href="https://twitter.com/sergiospagnuolo">S√©rgio Spagnuolo</a> e <a href="https://twitter.com/renata_mh">Renata Hirota</a>.</p>

<p><a href="https://github.com/voltdatalab/newsatlasbr" target="_blank"><button class="btn btn--dark btn--rounded btn--w-icon">Acesse o pacote tamb√©m no GitHub</button></a></p>

<h2 id="instalar-e-carregar-o-pacote">Instalar e carregar o pacote</h2>

<p>Atualmente, o <code class="language-plaintext highlighter-rouge">newsatlasbr</code> pode ser instalado diretamente do seu reposit√≥rio no GitHub:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="s2">"devtools"</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"devtools"</span><span class="p">)</span><span class="w">
</span><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"voltdatalab/newsatlasbr"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Uma vez instalado, ele pode ser carregado usando-se a fun√ß√£o <code class="language-plaintext highlighter-rouge">library</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">newsatlasbr</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="fun√ß√µes">Fun√ß√µes</h2>

<p><code class="language-plaintext highlighter-rouge">newsatlasbr</code> possui tr√™s grupos de fun√ß√µes:</p>

<ul>
  <li>Logar na API para obter um token;</li>
  <li>Obter dados agregados de munic√≠pios, estados ou regi√µes e produzir mapas desses dados;</li>
  <li>Obter dados de ve√≠culos de not√≠cia.</li>
</ul>

<p>Esse tutorial examina esses tr√™s grupos.</p>

<h3 id="logar-na-api">Logar na API</h3>

<p>Para acessar a API do Atlas da Not√≠cia, os usu√°rios <a href="https://api.atlas.jor.br/login">devem ser registrados</a> e inserir o e-mail e senha para autentica√ß√£o. A fun√ß√£o <code class="language-plaintext highlighter-rouge">atlasbr_sigin</code> registra essa informa√ß√£o na sess√£o de R do usu√°rio, para ela ser usada na obten√ß√£o do Bearer token de acesso a API.</p>

<p>A fun√ß√£o grava o e-mail e senha somente na sess√£o <em>atual</em> do usu√°rio. Assim, ele deve repetir essa opera√ß√£o a cada nova sess√£o de R em que ele queira utilizar o pacote. <em>O usu√°rio e senha s√£o pessoais. Ent√£o, os usu√°rios devem ser cautelosos ao escrev√™-los e salv√°-los em scripts, para evitar o seu compartilhamento</em>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">atlasbr_signin</span><span class="p">(</span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"example@account_exeample.com"</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pass"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="dados-agregados-de-munic√≠piosestadosregi√µes">Dados agregados de munic√≠pios/estados/regi√µes</h3>

<p>Usu√°rios que j√° exploraram artigos ou reportagens sobre o Atlas da Not√≠cia sabem que os munic√≠pios brasileiros s√£o classificados em 3 categorias, segundo o n√∫mero de ve√≠culos de not√≠cias em cada uma delas:</p>

<ul>
  <li><strong>Desertos de not√≠cia</strong>: nenhum ve√≠culo;</li>
  <li><strong>Quase desertos</strong>: 1 ou 2 ve√≠culos;</li>
  <li><strong>Outros</strong>: 3 ou mais.</li>
</ul>

<p>A fun√ß√£o <code class="language-plaintext highlighter-rouge">get_municipalities</code> combina requisi√ß√µes de API para as tr√™s categorias acima para criar um dataset √∫nico contendo o n√∫mero de ve√≠culos de not√≠cia em cada munic√≠pio brasileiro (al√©m de incluir outras informa√ß√µes sobre esses munic√≠pios). Como ela faz tr√™s requisi√ß√µes, a fun√ß√£o demora mais a retornar um resultado do que as fun√ß√µes que realizam uma √∫nica requisi√ß√£o. Contudo, ela √© a √∫nica que d√° um retrato completo dos 5565 munic√≠pios.</p>

<p>As fun√ß√µes a seguir t√™m uma estrutura semelhante (nenhum argumento) e retorna os seguintes bancos:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">news_deserts</code>: munic√≠pios que s√£o <em>desertos de not√≠cia</em>;</li>
  <li><code class="language-plaintext highlighter-rouge">almost_deserts</code>: municipalities that are <em>quase desertos</em>;</li>
  <li><code class="language-plaintext highlighter-rouge">n_orgs_100k</code>: munic√≠pios com, pelo menos, um ve√≠culo, informando tanto o <em>n√∫mero absoluto</em> de ve√≠culos quanto a sua <em>taxa por 100 mil habitantes</em>.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">all_municipalities</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_municipalities</span><span class="p">()</span><span class="w">
</span><span class="n">deserts_municipalities</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">news_deserts</span><span class="p">()</span><span class="w">
</span><span class="n">almost_deserts_muns</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">almost_deserts</span><span class="p">()</span><span class="w">
</span><span class="n">at_least_1_org_muns</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n_orgs_100k</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p>Essas fun√ß√µes t√™m ‚Äúpares‚Äù, que permitem a extra√ß√£o de dados agregados em estados/regi√µes:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">news_deserts_state</code>: retorna um banco com o n√∫mero agregado de <em>desertos de not√≠cias</em> em cada estado ou regi√£o. O padr√£o da fun√ß√£o s√£o estados (<code class="language-plaintext highlighter-rouge">regions = F</code>);</li>
  <li><code class="language-plaintext highlighter-rouge">almost_deserts_state</code>: retorna um banco com o n√∫mero agregado de <em>quase desertos</em> em cada estado ou regi√£o. O padr√£o da fun√ß√£o s√£o estados (<code class="language-plaintext highlighter-rouge">regions = F</code>);</li>
  <li><code class="language-plaintext highlighter-rouge">n_orgs_100k_state</code>: retorna um banco com o <em>n√∫mero absoluto</em> e a <em>taxa por 100 mil habitantes</em> de ve√≠culos de not√≠cias nos estados <strong>e</strong> regi√µes. Essa fun√ß√£o √© um pouco diferente das duas anteriores, uma vez que o banco de dados resultante dela <em>sempre</em> ter√° 27 observa√ß√µes. Se <code class="language-plaintext highlighter-rouge">regions = T</code> (que, ao contr√°rio das anteriores, √© o padr√£o da fun√ß√£o), novas colunas s√£o adicionadas, incluindo informa√ß√µes sobre a regi√£o em que cada estado est√° localizado.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">news_deserts_states</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">news_deserts_state</span><span class="p">()</span><span class="w">
</span><span class="n">almost_deserts_regions</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">almost_deserts_state</span><span class="p">(</span><span class="n">regions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">organizations_per_state</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n_orgs_100k_state</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p>Por fim, <code class="language-plaintext highlighter-rouge">newsatlasbr</code> tamb√©m inclui tr√™s fun√ß√µes para gerar e exportar mapas com essas informa√ß√µes, usando dados geogr√°ficos do pacote <code class="language-plaintext highlighter-rouge">geobr</code> e gr√°ficos do <code class="language-plaintext highlighter-rouge">ggplot2</code> (as legendas dos mapas, por√©m, est√£o em ingl√™s):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">news_deserts_map</code>: plota um mapa dos desertos de not√≠cia brasileiros. Os dados podem ser agregados em munic√≠pios, estados ou regi√µes (as tr√™s fun√ß√µes t√™m o munic√≠pio como padr√£o: <code class="language-plaintext highlighter-rouge">aggregation = "municipalities"</code>). Para estados e regi√µes, o usu√°rio deve escolhar se ele deseja visualizar o <em>n√∫mero absoluto</em> de desertos de not√≠cias (padr√£o) ou o <em>percentual</em> nessas agrega√ß√µes. Como nas demais fun√ß√µes, o usu√°rio pode exportar os mapas como um arquivo .jpg usando o argumento <code class="language-plaintext highlighter-rouge">export = T</code>.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plotar um mapa com o percentual de desertos de noticia em cada estado brasileiro</span><span class="w">
</span><span class="n">news_deserts_map</span><span class="p">(</span><span class="n">aggregation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"states"</span><span class="p">,</span><span class="w"> </span><span class="n">percentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">almost_deserts_map</code>: plota um mapa dos quase desertos de not√≠cia. Os dados podem ser agregados em munic√≠pios, estados e regi√µes. Ao contr√°rio da fun√ß√£o <code class="language-plaintext highlighter-rouge">news_deserts_map</code>, o usu√°rio s√≥ pode escolher o <em>n√∫mero absoluto</em> dos quase desertos em cada agrega√ß√£o.</li>
</ul>

<center>

![](https://github.com/voltdatalab/newsatlasbr/blob/master/images/states_deserts_percentage.jpg)

</center>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plota um mapa de quase desertos em cada regiao do pais</span><span class="w">
</span><span class="n">almost_deserts_map</span><span class="p">(</span><span class="n">aggregation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"regions"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<center>

![](https://github.com/voltdatalab/newsatlasbr/blob/master/images/region_almost_deserts.jpg)

</center>

<ul>
  <li><code class="language-plaintext highlighter-rouge">n_orgs_100k_map</code>:  plota um mapa com informa√ß√£o sobre o n√∫mero de ve√≠culos por 100 mil habitantes. Os dados podem ser em n√≠vel municipal, estadual ou regional.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plota um mapa com o numero de organizacoes por 100k/hab em cada municipio</span><span class="w">
</span><span class="n">n_orgs_100k_map</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<center>

![](https://github.com/voltdatalab/newsatlasbr/blob/master/images/cities_100k_map.jpg)

</center>

<h3 id="dados-sobre-ve√≠culos-de-not√≠cia">Dados sobre ve√≠culos de not√≠cia</h3>

<p>Existem duas fun√ß√µes para extrair dados de ve√≠culos de not√≠cias brasileiros: <code class="language-plaintext highlighter-rouge">organizations_state</code> e <code class="language-plaintext highlighter-rouge">organizations_region</code>. Ambas t√™m uma estrutura semelhante: os argumentos padr√£o retornam dados de estados/regi√µes informados (o usu√°rio pode inserir <code class="language-plaintext highlighter-rouge">uf = "All"</code> ou <code class="language-plaintext highlighter-rouge">region = "All"</code> para obter os dados do pa√≠s inteiro - esta op√ß√£o demora mais para retornar os dados, por√©m); somente ve√≠culos de not√≠cia (<code class="language-plaintext highlighter-rouge">news = 1</code>) - excluindo, portanto os ve√≠culos n√£o-jornal√≠sticos; e todos os tipos de m√≠dia (<code class="language-plaintext highlighter-rouge">media = "all"</code>).</p>

<p>Portanto, o usu√°rio pode escolher obter dados para o pa√≠s inteiro, como dito. Ele tamb√©m pode obter todos os ve√≠culos (<code class="language-plaintext highlighter-rouge">news = "all"</code>), isto √© ve√≠culos jornal√≠sticos e n√£o-jornal√≠sticos. Por fim, ele pode restringir os dados a somente um subconjunto de m√≠dias, como ‚Äúimpresso‚Äù, ‚Äúonline‚Äù, ‚Äúradio‚Äù e ‚Äútv‚Äù.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Extrair dados de todos veiculos jornalisticos do estado de SP</span><span class="w">
</span><span class="n">sao_paulo_media</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">organizations_state</span><span class="p">(</span><span class="n">uf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SP"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Extrair dados de todos os veiculos jornalisticos do pais</span><span class="w">
</span><span class="n">brazil_media</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">organizations_state</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"all"</span><span class="p">)</span><span class="w">
</span><span class="n">brazil_media</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">organizations_region</span><span class="p">(</span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"all"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Extrair dados de veiculos impressos em Pernambuco</span><span class="w">
</span><span class="n">pernambuco_print</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">organizations_state</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PE"</span><span class="p">,</span><span class="w"> </span><span class="n">media</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"print"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Extrair dados de veiculos jornalisticos de TV na regiao Centro-Oeste</span><span class="w">
</span><span class="n">cw_tv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">organizations_region</span><span class="p">(</span><span class="s2">"Central-West"</span><span class="p">,</span><span class="w"> </span><span class="n">media</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
:ET